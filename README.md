# [Pet-проект “Social Media API (SMA)”](https://github.com/Sergistan/sma)

## Описание

Social Media API предоставляет собой RESTful API для социальной медиа платформы позволяющей пользователям регистрироваться, 
входить в систему, создавать посты, переписываться в чате, подписываться на других пользователей, добавлять в друзья других пользователей, получать свою ленту 
активности и уведомления по почте о новых постах 
по [заранее описанной спецификации](KafkaProducer-for-SMA/src/main/resources/static/openapi.yaml).

Проект разделен на два подпроекта: [SMA-producer](https://github.com/Sergistan/producer) и [SMA-consumer](https://github.com/Sergistan/comsumer) для взаимодействия через брокер сообщений Kafka.

## Основные технологии:

- Приложение разработано с использованием Spring Boot;
- Использован сборщик пакетов Gradle;
- Использована база данных PostgreSQL;
- Использована система управления миграциями Liquibase;
- Добавлена документация эндпоинтов с использованием OpenAPI;
- При создании постов картинки хранятся в облачном хранилище Minio;
- Добавлена регистрация и аутентификация пользователей по JWT-токенам через Spring Security;
- Использовалось кэширование Redis;
- Использован брокер сообщений Kafka для отправки сообщений между проектами SMA-producer и SMA-consumer;
- Использовалась библиотека MailSender для оповещения пользователей;
- Для запуска используются два Dockerfile и docker-compose;
- С помощью [веб-страницы](KafkaProducer-for-SMA/src/main/resources/templates/start.html) осуществляется общения двух пользователей (друзей) в чате по Websocket;
- Код покрыт Unit-тестами с использованием JUnit5, Mockito для тестирования сервисного слоя приложения;
- Протестированы контроллеры с помощью WebMvcTest и репозитории с помощью DataJpaTest;
- Добавлены интеграционные тесты с использованием Testcontainers для тестирования работы кэша и отправки сообщений в брокер Kafka;
- Для сборки проекта и образов докер в CI/CD в среде Jenkins используется Jenkinsfile.

## Основные требования:
1.  Аутентификация и авторизация:
- Пользователи могут зарегистрироваться, указав имя пользователя, электронную почту и пароль (имя пользователя и электронная почта должны быть уникальными).
- Пользователи могут войти в систему, предоставив правильные учетные данные.
- API должен обеспечивать защиту конфиденциальности пользовательских данных, включая хеширование паролей и использование JWT.
- Пользователь может обновить токены аутентификации и обновления.
2.  Управление постами:
- Пользователи могут создавать новые посты, указывая текст, заголовок и прикрепляя изображения (изображение должно храниться в облачном хранилище Minio).
- Пользователи могут просматривать посты других пользователей.
- Пользователи могут обновлять и удалять свои собственные посты.
- При получении, обновлении и удалении постов они должны быть также добавлены, обновлены и удалены в кэше.
- При создании и обновлении поста, пост отправляется из подпроекта SMA-producer через брокер сообщений Kafka в подпроект SMA-consumer, где в последствии обрабатывается и через MailSender оповещаются через электронную почту подписчики пользователя, который создал или обновил пост.
- Админ может получить все посты из базы данных.
3. Взаимодействие пользователей:
- Пользователи могут отправлять заявки в друзья другим пользователям. С этого момента, пользователь, отправивший заявку, остается подписчиком до тех пор, пока сам не откажется от подписки. Если пользователь, получивший заявку, принимает ее, оба пользователя становятся друзьями. Если отклонит, то пользователь, отправивший заявку, как и указано ранее, все равно остается подписчиком.
- Пользователи, являющиеся друзьями, также являются подписчиками друг на друга.
- Если один из друзей удаляет другого из друзей, то он также отписывается. Второй пользователь при этом должен остаться подписчиком.
- Пользователь может получать, создавать или удалять чат, присоединяться или отключаться от чата.
- Друзья могут писать друг другу сообщения (чат реализован через WebSocket).
- Пользователь может получить последнее сообщение из своего чата.
- Пользователь может найти другого пользователя по имени.
- Пользователь может получить список всех своих друзей.
- Пользователь может получить список всех своих подписчиков.
- Админ может получить все чаты из базы данных.
- Админ может получить всех пользователей из базы данных.
4.  Подписки и лента активности:
- Лента активности пользователя должна отображать последние посты от пользователей, на которых он подписан.
- Лента активности должна поддерживать пагинацию и сортировку по времени создания постов.
5.  Обработка ошибок:
- API должно обрабатывать и возвращать понятные сообщения об ошибках при неправильном запросе или внутренних проблемах сервера.
- API должно осуществлять валидацию введенных данных и возвращать информативные сообщения при неправильном формате.
6.  Документация API:
- API должно быть хорошо задокументировано с использованием OpenAPI.
- Документация должна содержать описания доступных эндпоинтов, форматы запросов и ответов, а также требования к аутентификации.

## Стартовые пользователи:

**USERNAME:** Sergey **PASSWORD:** 111

**USERNAME:** Ilya **PASSWORD:** 222

**USERNAME:** Alina **PASSWORD:** 333

## Стартовый админ:

**USERNAME:** Tom **PASSWORD:** 444

## Запуск приложения

### Запуск приложения через Docker:

1. Скачать основной проект и два подмодуля (producer и consumer), переместить producer и consumer в основной проект, выполнить `gradle -> clean -> build` для producer и consumer;
2. Запустить `docker-compose up`.
Автоматически создадутся все необходимые сервисы для работы приложения, в базе данных появятся стартовые пользователи и админ.

### Работа приложения:

После ввода логина и пароля одного из стартовых пользователей или админа происходит аутентификация, и у пользователя возникает возможность работы с приложением.
